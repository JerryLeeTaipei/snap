name: alsa-utils
version: 1.2.4-j-1
summary: Utilities for configuring and using ALSA
description: |
    This package contains various tools to configure audio devices via ALSA
    ALSA is the Advanced Linux Sound Architecture.

    The source can be found at: https://code.launchpad.net/~snappy-hwe-team/snappy-hwe-snaps/+git/alsa-utils/
confinement: strict
base: core20
grade: stable
architectures:
  - build-on: [amd64]
    run-on: arm64

apps:
    alsa-restore:
        daemon: simple
        command: bin/alsa-stated
        plugs: [alsa, device-conf]
    speaker-test:
        command: usr/bin/speaker-test
        plugs: [ alsa, home ]
        aliases: [speaker-test]
    alsactl:
        command: usr/sbin/alsactl
        plugs: [ alsa, home ]
        aliases: [alsactl]
    amixer:
        command: usr/bin/amixer
        plugs: [ alsa, home ]
        aliases: [amixer]
    aplay:
        command: usr/bin/aplay
        plugs: [ alsa, home ]
        aliases: [aplay]
    aseqnet:
        command: usr/bin/aseqnet
        plugs: [ alsa, home ]
        aliases: [aseqnet]
    alsatplg:
        command: usr/bin/alsatplg
        plugs: [ alsa, home ]
        aliases: [alsatplg]
    arecordmidi:
        command: usr/bin/arecordmidi
        plugs: [ alsa, home ]
        aliases: [arecordmidi]
    amidi:
        command: usr/bin/amidi
        plugs: [ alsa, home ]
        aliases: [amidi]
    alsaucm:
        command: usr/bin/alsaucm
        plugs: [ alsa, home ]
        aliases: [alsaucm]
    aconnect:
        command: usr/bin/aconnect
        plugs: [ alsa, home ]
        aliases: [aconnect]
    iecset:
        command: usr/bin/iecset
        plugs: [ alsa, home ]
        aliases: [iecset]
    alsabat:
        command: usr/bin/alsabat
        plugs: [ alsa, home ]
        aliases: [alsabat]
    aseqdump:
        command: usr/bin/aseqdump
        plugs: [ alsa, home ]
        aliases: [aseqdump]
    aplaymidi:
        command: usr/bin/aplaymidi
        plugs: [ alsa, home ]
        aliases: [aplaymidi]
    arecord:
        command: usr/bin/arecord
        plugs: [ alsa, home ]
        aliases: [arecord]

plugs:
    device-conf:
        interface: content
        content: alsa-conf
        target: var/lib/alsa

parts:
    alsa-lib:
        plugin: autotools
        source: ftp://ftp.alsa-project.org/pub/lib/alsa-lib-1.2.4.tar.bz2
        autotools-configure-parameters:
            - --prefix=/usr
            - --sysconfdir=/etc
            - --libexec=/usr/lib
            - --libdir=/usr/lib
            - --localstatedir=/var
            - --with-configdir=/snap/$SNAPCRAFT_PROJECT_NAME/current/usr/share/alsa
            - --with-plugindir=/snap/$SNAPCRAFT_PROJECT_NAME/current/usr/lib/alsa-lib
            - --build x86_64-pc-linux-gnu
            - --host aarch64-linux-gnu
        stage:
            - -usr/include
            - -usr/lib
            - -usr/share/alsa/alsa.conf
            - -usr/share/alsa/pcm
            - -usr/share/alsa/topology/broadwell
        prime:
            - -usr/bin
            - -usr/lib
            - -usr/include
            - -usr/lib/pkgconfig
            - -usr/share/alsa/alsa.conf
            - -usr/share/alsa/pcm
            - -usr/share/alsa/topology/broadwell

    alsa-utils:
        after: [ alsa-lib ]
        plugin: autotools
        build-environment:
            - CFLAGS: "-I$SNAPCRAFT_PROJECT_DIR/parts/alsa-lib/install/usr/include"
            - LDFLAGS: "-L$SNAPCRAFT_PROJECT_DIR/parts/alsa-lib/install/usr//lib"
        source: ftp://ftp.alsa-project.org/pub/utils/alsa-utils-1.2.4.tar.bz2
        autotools-configure-parameters:
            - --prefix=/usr
            - --sysconfdir=/etc
            - --libexec=/usr/lib
            - --libdir=/usr/lib
            - --localstatedir=/var
            - --build x86_64-pc-linux-gnu
            - --host aarch64-linux-gnu
            - --disable-alsamixer
            - --disable-alsaloop
        prime:
            - -usr/include

    alsa-stated:
        plugin: dump
        source: bin
        organize:
            alsa-stated: bin/
